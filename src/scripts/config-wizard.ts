import inquirer from 'inquirer';
import fs from 'fs';
import axios from 'axios';

export async function runConfigWizard() {
  console.log('âš™ï¸ Advanced Configuration Wizard for Revolutionary Platform\n');

  try {
    // Advanced configuration options
    const config = await inquirer.prompt([
      {
        type: 'input',
        name: 'googleApiKey',
        message: 'ğŸ”‘ Google PageSpeed Insights API Key:',
        default: process.env.GOOGLE_PAGESPEED_API_KEY || '',
        validate: (input: string) => {
          return input.length >= 10 || 'API key required (minimum 10 characters)';
        }
      },
      {
        type: 'checkbox',
        name: 'features',
        message: 'ğŸš€ Select revolutionary features to enable:',
        choices: [
          { name: 'ğŸ“Š SEO Intelligence Suite', value: 'seo', checked: true },
          { name: 'ğŸ¥ Multimedia Testing', value: 'multimedia', checked: true },
          { name: 'ğŸ” Keyword Intelligence', value: 'keywords', checked: true },
          { name: 'âš¡ Performance Analytics', value: 'performance', checked: true },
          { name: 'ğŸŒ Network Monitoring', value: 'network', checked: true },
          { name: 'ğŸ¯ Competitive Intelligence', value: 'competitive', checked: true }
        ]
      },
      {
        type: 'list',
        name: 'serverMode',
        message: 'ğŸ–¥ï¸  Server deployment mode:',
        choices: [
          { name: 'Development (Local testing)', value: 'development' },
          { name: 'Production (Enterprise deployment)', value: 'production' },
          { name: 'Professional Services (Client delivery)', value: 'professional' }
        ],
        default: 'development'
      },
      {
        type: 'number',
        name: 'maxSessions',
        message: 'ğŸ”¢ Maximum concurrent browser sessions:',
        default: 5,
        validate: (input: number) => {
          return (input >= 1 && input <= 20) || 'Must be between 1 and 20 sessions';
        }
      },
      {
        type: 'list',
        name: 'browserType',
        message: 'ğŸŒ Default browser preference:',
        choices: [
          { name: 'Chrome (Recommended)', value: 'chrome' },
          { name: 'Firefox', value: 'firefox' },
          { name: 'Safari (macOS only)', value: 'safari' },
          { name: 'Edge', value: 'edge' }
        ],
        default: 'chrome'
      },
      {
        type: 'confirm',
        name: 'headlessMode',
        message: 'ğŸ‘» Enable headless mode (recommended for servers)?',
        default: true
      },
      {
        type: 'list',
        name: 'logLevel',
        message: 'ğŸ“ Logging level:',
        choices: ['error', 'warn', 'info', 'debug'],
        default: 'info'
      },
      {
        type: 'confirm',
        name: 'enableCaching',
        message: 'ğŸ’¾ Enable result caching for performance?',
        default: true
      },
      {
        type: 'confirm',
        name: 'saveAdvancedConfig',
        message: 'ğŸ’¾ Save advanced configuration?',
        default: true
      }
    ]);

    if (config.saveAdvancedConfig) {
      // Create comprehensive .env file
      const envContent = `# Revolutionary MCP Browser Control Server - Advanced Configuration
# Generated by config wizard on ${new Date().toISOString()}

# GOOGLE API CONFIGURATION
GOOGLE_PAGESPEED_API_KEY=${config.googleApiKey}

# FEATURE TOGGLES
ENABLE_SEO_FEATURES=${config.features.includes('seo')}
ENABLE_MULTIMEDIA_TESTING=${config.features.includes('multimedia')}
ENABLE_KEYWORD_INTELLIGENCE=${config.features.includes('keywords')}
ENABLE_PERFORMANCE_ANALYTICS=${config.features.includes('performance')}
ENABLE_NETWORK_MONITORING=${config.features.includes('network')}
ENABLE_COMPETITIVE_INTELLIGENCE=${config.features.includes('competitive')}

# SERVER CONFIGURATION
SERVER_MODE=${config.serverMode}
MAX_CONCURRENT_SESSIONS=${config.maxSessions}
DEFAULT_BROWSER=${config.browserType}
HEADLESS_MODE=${config.headlessMode}
LOG_LEVEL=${config.logLevel}
ENABLE_CACHING=${config.enableCaching}

# PERFORMANCE SETTINGS
PAGE_LOAD_TIMEOUT=30000
ELEMENT_TIMEOUT=10000
SCREENSHOT_QUALITY=80
BROWSER_TIMEOUT=60000

# ADVANCED SETTINGS (Professional Services)
# ENABLE_PDF_GENERATION=false
# ENABLE_PREMIUM_TEMPLATES=false
# CLIENT_BRANDING_PATH=./branding/
# REPORTS_OUTPUT_PATH=./browser-control/reports/

# SECURITY SETTINGS
SELENIUM_IMPLICIT_WAIT=10000
DISABLE_WEB_SECURITY=false
IGNORE_SSL_ERRORS=false

# MONITORING & ANALYTICS
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_ERROR_TRACKING=true
METRICS_COLLECTION=true
`;

      fs.writeFileSync('.env', envContent);

      console.log('\nâœ… Advanced configuration saved to .env');
      console.log('ğŸ¯ Revolutionary platform configured for optimal performance!');

      // Show feature summary
      console.log('\nğŸš€ Enabled Features:');
      config.features.forEach((feature: string) => {
        const featureNames = {
          seo: 'ğŸ“Š SEO Intelligence Suite',
          multimedia: 'ğŸ¥ Multimedia Testing',
          keywords: 'ğŸ” Keyword Intelligence',
          performance: 'âš¡ Performance Analytics',
          network: 'ğŸŒ Network Monitoring',
          competitive: 'ğŸ¯ Competitive Intelligence'
        };
        console.log(`  âœ… ${featureNames[feature] || feature}`);
      });

      console.log('\nğŸ“‹ Next Steps:');
      console.log('  mcp-browser-control test-config        # Validate setup');
      console.log('  mcp-browser-control start              # Start server');
      console.log('  mcp-browser-control analyze <url>      # Test analysis');

      console.log('\nğŸ’ Revolutionary capabilities ready for professional use!');

    } else {
      console.log('\nâš ï¸  Configuration not saved. Run wizard again when ready.');
    }

  } catch (error) {
    console.log('\nâŒ Configuration wizard failed:', error.message);
    console.log('ğŸ”§ Try simple setup: mcp-browser-control setup');
    console.log('ğŸ“– Documentation: GOOGLE-API-SETUP.md');
  }
}

// CLI entry point
if (import.meta.url === `file://${process.argv[1]}`) {
  runConfigWizard().catch(console.error);
}